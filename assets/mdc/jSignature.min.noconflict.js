(function(a){(function(){var b="jSignature";var j=function(s,u){var t;this.kick=function(){clearTimeout(t);t=setTimeout(u,s)};this.clear=function(){clearTimeout(t)};return this};var c=function(s){this.topics={};this.context=s?s:this;this.publish=function(x,z,y,u){if(this.topics[x]){var A=this.topics[x],B=Array.prototype.slice.call(arguments,1),D=[],C,w,t,v;for(w=0,t=A.length;w<t;w++){v=A[w];if(v===null){continue}C=v[0];if(v[1]){v[0]=function(){};D.push(w)}C.apply(this.context,B)}for(w=0,t=D.length;w<t;w++){A.splice(D[w],1)}}};this.subscribe=function(t,v,u){if(!this.topics[t]){this.topics[t]=[[v,u]]}else{this.topics[t].push([v,u])}return{topic:t,callback:v}};this.unsubscribe=function(w){if(this.topics[w.topic]){var u=this.topics[w.topic];for(var v=0,t=u.length;v<t;v++){if(u[v]&&u[v][0]===w.callback){u[v]=null}}}}};function n(v){var I,u,C=v.css("color"),s,H=v[0];var J=false;while(H&&!s&&!J){try{I=a(H).css("background-color")}catch(G){I="transparent"}if(I!=="transparent"&&I!=="rgba(0, 0, 0, 0)"){s=I}J=H.body;H=H.parentNode}var E=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,D=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,t;I=u;I=C.match(E);if(I){t={r:parseInt(I[1],10),g:parseInt(I[2],10),b:parseInt(I[3],10)}}else{I=C.match(D);if(I){t={r:parseInt(I[1],16),g:parseInt(I[2],16),b:parseInt(I[3],16)}}}var z;if(!s){if(t){if(Math.max.apply(null,[t.r,t.g,t.b])>127){z={r:0,g:0,b:0}}else{z={r:255,g:255,b:255}}}else{z={r:255,g:255,b:255}}}else{I=u;I=s.match(E);if(I){z={r:parseInt(I[1],10),g:parseInt(I[2],10),b:parseInt(I[3],10)}}else{I=s.match(D);if(I){z={r:parseInt(I[1],16),g:parseInt(I[2],16),b:parseInt(I[3],16)}}}}var w=function(K){return"rgb("+[K.r,K.g,K.b].join(", ")+")"},B,F,x;if(t&&z){var y=Math.max.apply(null,[t.r,t.g,t.b]);F=Math.max.apply(null,[z.r,z.g,z.b]);x=Math.round(F+(-1*(F-y)*0.75));B={r:x,g:x,b:x}}else{if(t){F=Math.max.apply(null,[t.r,t.g,t.b]);var A=+1;if(F>127){A=-1}x=Math.round(F+(A*96));B={r:x,g:x,b:x}}else{B={r:191,g:191,b:191}}}return{color:C,"background-color":z?w(z):s,"decor-color":w(B)}}function i(s,u){this.x=s;this.y=u;this.reverse=function(){return new this.constructor(this.x*-1,this.y*-1)};this._length=null;this.getLength=function(){if(!this._length){this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}return this._length};var t=function(v){return Math.round(v/Math.abs(v))};this.resizeTo=function(w){if(this.x===0&&this.y===0){this._length=0}else{if(this.x===0){this._length=w;this.y=w*t(this.y)}else{if(this.y===0){this._length=w;this.x=w*t(this.x)}else{var z=Math.abs(this.y/this.x),v=Math.sqrt(Math.pow(w,2)/(1+Math.pow(z,2))),A=z*v;this._length=w;this.x=v*t(this.x);this.y=A*t(this.y)}}}return this};this.angleTo=function(v){var w=this.getLength()*v.getLength();if(w===0){return 0}else{return Math.acos(Math.min(Math.max((this.x*v.x+this.y*v.y)/w,-1),1))/Math.PI}}}function o(s,t){this.x=s;this.y=t;this.getVectorToCoordinates=function(u,v){return new i(u-this.x,v-this.y)};this.getVectorFromCoordinates=function(u,v){return this.getVectorToCoordinates(u,v).reverse()};this.getVectorToPoint=function(u){return new i(u.x-this.x,u.y-this.y)};this.getVectorFromPoint=function(u){return this.getVectorToPoint(u).reverse()}}function p(s,t,w,B,v){this.data=s;this.context=t;if(s.length){var y=s.length,A,z;for(var x=0;x<y;x++){A=s[x];z=A.x.length;w.call(t,A);for(var u=1;u<z;u++){B.call(t,A,u)}v.call(t,A)}}this.changed=function(){};this.startStrokeFn=w;this.addToStrokeFn=B;this.endStrokeFn=v;this.inStroke=false;this._lastPoint=null;this._stroke=null;this.startStroke=function(C){if(C&&typeof(C.x)=="number"&&typeof(C.y)=="number"){this._stroke={x:[C.x],y:[C.y]};this.data.push(this._stroke);this._lastPoint=C;this.inStroke=true;var F=this._stroke,E=this.startStrokeFn,D=this.context;setTimeout(function(){E.call(D,F)},3);return C}else{return null}};this.addToStroke=function(D){if(this.inStroke&&typeof(D.x)==="number"&&typeof(D.y)==="number"&&(Math.abs(D.x-this._lastPoint.x)+Math.abs(D.y-this._lastPoint.y))>4){var C=this._stroke.x.length;this._stroke.x.push(D.x);this._stroke.y.push(D.y);this._lastPoint=D;var G=this._stroke,F=this.addToStrokeFn,E=this.context;setTimeout(function(){F.call(E,G,C)},3);return D}else{return null}};this.endStroke=function(){var G=this.inStroke;this.inStroke=false;this._lastPoint=null;if(G){var F=this._stroke,E=this.endStrokeFn,D=this.context,C=this.changed;setTimeout(function(){E.call(D,F);C.call(D)},3);return true}else{return null}}}var k=function(t,s,w,v){var u=t.fillStyle;t.fillStyle=t.strokeStyle;t.fillRect(s+v/-2,w+v/-2,v,v);t.fillStyle=u},f=function(t,u,s,w,v){t.beginPath();t.moveTo(u,s);t.lineTo(w,v);t.stroke()},q=function(A,t,s,x,w,v,u,z,y){A.beginPath();A.moveTo(t,s);A.bezierCurveTo(v,u,z,y,x,w);A.stroke()},e=function(s){k(this.canvasContext,s.x[0],s.y[0],this.settings.lineWidth)},h=function(F,D){var t=new o(F.x[D-1],F.y[D-1]),y=new o(F.x[D],F.y[D]),u=t.getVectorToPoint(y);if(D>1){var E=new o(F.x[D-2],F.y[D-2]),A=E.getVectorToPoint(t),w;if(A.getLength()>this.lineCurveThreshold){if(D>2){w=(new o(F.x[D-3],F.y[D-3])).getVectorToPoint(E)}else{w=new i(0,0)}var s=0.05,v=A.getLength()*0.35,C=A.angleTo(w.reverse()),B=u.angleTo(A.reverse()),z=new i(w.x+A.x,w.y+A.y).resizeTo(Math.max(s,C)*v),x=(new i(A.x+u.x,A.y+u.y)).reverse().resizeTo(Math.max(s,B)*v);q(this.canvasContext,E.x,E.y,t.x,t.y,E.x+z.x,E.y+z.y,t.x+x.x,t.y+x.y)}}if(u.getLength()<=this.lineCurveThreshold){f(this.canvasContext,t.x,t.y,y.x,y.y)}},m=function(w){var u=w.x.length-1;if(u>0){var y=new o(w.x[u],w.y[u]),t=new o(w.x[u-1],w.y[u-1]),s=t.getVectorToPoint(y),x;if(s.getLength()>this.lineCurveThreshold){if(u>1){x=(new o(w.x[u-2],w.y[u-2])).getVectorToPoint(t);var v=new i(x.x+s.x,x.y+s.y).resizeTo(s.getLength()/2);q(this.canvasContext,t.x,t.y,y.x,y.y,t.x+v.x,t.y+v.y,y.x,y.y)}else{f(this.canvasContext,t.x,t.y,y.x,y.y)}}}};function l(t,v,u,s){if(v==="ratio"||v.split("")[v.length-1]==="%"){this.eventTokens[u+".parentresized"]=s.subscribe(u+".parentresized",(function(z,y,w,x){return function(){var A=y.width();if(A<1){return}if(A!==w){for(var B in z){if(z.hasOwnProperty(B)){s.unsubscribe(z[B]);delete z[B]}}var C=t.settings;t.$parent.children().remove();for(var B in t){if(t.hasOwnProperty(B)){delete t[B]}}C.data=(function(I,F){var L=[];var D,J,G,H,E,K;for(J=0,G=I.length;J<G;J++){K=I[J];D={x:[],y:[]};for(H=0,E=K.x.length;H<E;H++){D.x.push(K.x[H]*F);D.y.push(K.y[H]*F)}L.push(D)}return L})(C.data,A*1/w);y[u](C)}}})(this.eventTokens,this.$parent,this.$parent.width(),this.canvas.width*1/this.canvas.height))}}function g(A,D,x){var w=this.$parent=a(A),B=this.eventTokens={},C=this.events=new c(this),u=a.fn[b]("globalEvents"),v={width:"ratio",height:"ratio",sizeRatio:2.5,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:false,showLine:true,data:[]};a.extend(v,n(w));if(D){a.extend(v,D)}this.settings=v;for(var z in x){if(x.hasOwnProperty(z)){x[z].call(this,z)}}this.events.publish(b+".initializing");this.$controlbarUpper=(function(){var E="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;";return a('<div style="'+E+'"></div>').appendTo(w)})();this.isCanvasEmulator=false;var t=this.canvas=this.initializeCanvas(v),y=a(t);this.$controlbarLower=(function(){var E="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;";return a('<div style="'+E+'"></div>').appendTo(w)})();this.canvasContext=t.getContext("2d");y.data(b+".this",this);v.lineWidth=(function(F,E){if(!F){return Math.max(Math.round(E/400),2)}else{return F}})(v.lineWidth,t.width);this.lineCurveThreshold=v.lineWidth*3;if(v.cssclass&&a.trim(v.cssclass)!=""){y.addClass(v.cssclass)}this.fatFingerCompensation=0;var s=(function(F){var I,H,E=function(){var K=a(F.canvas).offset();I=K.left*-1;H=K.top*-1},G=function(L){var K=(L.changedTouches&&L.changedTouches.length>0?L.changedTouches[0]:L);return new o(Math.round(K.pageX+I),Math.round(K.pageY+H)+F.fatFingerCompensation)},J=new j(750,function(){F.dataEngine.endStroke()});this.drawEndHandler=function(L){try{L.preventDefault()}catch(K){}J.clear();F.dataEngine.endStroke()};this.drawStartHandler=function(K){K.preventDefault();if(jQuery("input:focus").length>0){jQuery("input:focus").blur()}E();F.dataEngine.startStroke(G(K));J.kick()};this.drawMoveHandler=function(K){K.preventDefault();if(!F.dataEngine.inStroke){return}F.dataEngine.addToStroke(G(K));J.kick()};return this}).call({},this);(function(J,H,F){var E=this.canvas,I=a(E),G;if(this.isCanvasEmulator){I.bind("mousemove."+b,F);I.bind("mouseup."+b,J);I.bind("mousedown."+b,H)}else{E.ontouchstart=function(K){E.onmousedown=G;E.onmouseup=G;E.onmousemove=G;this.fatFingerCompensation=(v.minFatFingerCompensation&&v.lineWidth*-3>v.minFatFingerCompensation)?v.lineWidth*-3:v.minFatFingerCompensation;H(K);E.ontouchend=J;E.ontouchstart=H;E.ontouchmove=F};E.onmousedown=function(K){E.ontouchstart=G;E.ontouchend=G;E.ontouchmove=G;H(K);E.onmousedown=H;E.onmouseup=J;E.onmousemove=F}}}).call(this,s.drawEndHandler,s.drawStartHandler,s.drawMoveHandler);B[b+".windowmouseup"]=u.subscribe(b+".windowmouseup",s.drawEndHandler);this.events.publish(b+".attachingEventHandlers");l.call(this,this,v.width.toString(10),b,u);this.resetCanvas(v.data);this.events.publish(b+".initialized");return this}g.prototype.resetCanvas=function(y){var u=this.canvas,w=this.settings,A=this.canvasContext,t=this.isCanvasEmulator,x=u.width,s=u.height;A.clearRect(0,0,x+30,s+30);A.shadowColor=A.fillStyle=w["background-color"];if(t){A.fillRect(0,0,x+30,s+30)}A.lineWidth=Math.ceil(parseInt(w.lineWidth,10));A.lineCap=A.lineJoin="round";if(w.showLine){A.strokeStyle=w["decor-color"];A.shadowOffsetX=0;A.shadowOffsetY=0;var v=Math.round(s/5);f(A,v*1.5,s-v,x-(v*1.5),s-v)}A.strokeStyle=w.color;if(!t){A.shadowColor=A.strokeStyle;A.shadowOffsetX=A.lineWidth*0.5;A.shadowOffsetY=A.lineWidth*-0.6;A.shadowBlur=0}if(!y){y=[]}var z=this.dataEngine=new p(y,this,e,h,m);w.data=y;a(u).data(b+".data",y).data(b+".settings",w);z.changed=(function(D,B,C){return function(){B.publish(C+".change");D.trigger("change")}})(this.$parent,this.events,b);z.changed();return true};function r(s){if(s.getContext){return false}else{var w=s.ownerDocument.parentWindow;var v=w.FlashCanvas?s.ownerDocument.parentWindow.FlashCanvas:(typeof FlashCanvas==="undefined"?undefined:FlashCanvas);if(v){s=v.initElement(s);var u=1;if(w&&w.screen&&w.screen.deviceXDPI&&w.screen.logicalXDPI){u=w.screen.deviceXDPI*1/w.screen.logicalXDPI}if(u!==1){try{a(s).children("object").get(0).resize(Math.ceil(s.width*u),Math.ceil(s.height*u));s.getContext("2d").scale(u,u)}catch(t){}}return true}else{throw new Error("Canvas element does not support 2d context. jSignature cannot proceed.")}}}g.prototype.initializeCanvas=function(t){var s=document.createElement("canvas"),u=a(s);if(t.width===t.height&&t.height==="ratio"){t.width="100%"}u.css("margin",0).css("padding",0).css("border","none").css("height",t.height==="ratio"||!t.height?1:t.height.toString(10)).css("width",t.width==="ratio"||!t.width?1:t.width.toString(10));u.appendTo(this.$parent);if(t.height==="ratio"){u.css("height",Math.round(u.width()/t.sizeRatio))}else{if(t.width==="ratio"){u.css("width",Math.round(u.height()*t.sizeRatio))}}u.addClass(b);s.width=u.width();s.height=u.height();this.isCanvasEmulator=r(s);s.onselectstart=function(v){if(v&&v.preventDefault){v.preventDefault()}if(v&&v.stopPropagation){v.stopPropagation()}return false};return s};var d=function(C){var t=new c();(function(D,I,J,H){var F,G=function(){D.publish(I+".parentresized")};J(H).bind("resize."+I,function(){if(F){clearTimeout(F)}F=setTimeout(G,500)}).bind("mouseup."+I,function(K){D.publish(I+".windowmouseup")});var E=H.jmfw;E("div.jmuiPage").bind("jmuiPageAnimationEnd",function(K){if(K.direction==="in"){if(F){clearTimeout(F)}F=setTimeout(G,500)}})})(t,b,a,C);var z={};var s={"default":function(D){return this.toDataURL()},"native":function(D){return D},image:function(F){var E=this.toDataURL();if(typeof E==="string"&&E.length>4&&E.slice(0,5)==="data:"&&E.indexOf(",")!==-1){var D=E.indexOf(",");return[E.slice(5,D),E.substr(D+1)]}return[]}};function B(F,H,E){var D=new Image(),G=this;D.onload=function(){var I=G.getContext("2d").drawImage(D,0,0,(D.width<G.width)?D.width:G.width,(D.height<G.height)?D.height:G.height)};D.src="data:"+H+","+F}var u={"native":function(E,F,D){D(E)},image:B,"image/png;base64":B,"image/jpeg;base64":B,"image/jpg;base64":B};function x(D){if(this.find("canvas."+b).length>0){this.find("canvas."+b).add(this.filter("canvas."+b)).data(b+".this").resetCanvas(D)}return this}function A(F,G){var D;if(G===D&&typeof F==="string"&&F.substr(0,5)==="data:"){G=F.slice(5).split(",")[0];F=F.slice(6+G.length);if(G===F){return}}var E=this.find("canvas."+b).add(this.filter("canvas."+b));if(!u.hasOwnProperty(G)){throw new Error(b+" is unable to find import plugin with for format '"+String(G)+"'")}else{if(E.length!==0){u[G].call(E[0],F,G,(function(H){return function(){return H.resetCanvas.apply(H,arguments)}})(E.data(b+".this")))}}return this}var y=function(E){var D=false;E=E.parentNode;while(E&&!D){D=E.body;E=E.parentNode}return !D};var w={"export":s,"import":u,instance:z},v={init:function(D){return this.each(function(){if(!y(this)){new g(this,D,z)}})},getSettings:function(){return this.find("canvas."+b).add(this.filter("canvas."+b)).data(b+".this").settings},clear:x,reset:x,addPlugin:function(F,E,D){if(w.hasOwnProperty(F)){w[F][E]=D}return this},listPlugins:function(G){var E=[];if(w.hasOwnProperty(G)){var F=w[G];for(var D in F){if(F.hasOwnProperty(D)){E.push(D)}}}return E},getData:function(F){var D,E=this.find("canvas."+b).add(this.filter("canvas."+b));if(F===D){F="default"}if(E.length!==0&&s.hasOwnProperty(F)){return s[F].call(E.get(0),E.data(b+".data"))}},importData:A,setData:A,globalEvents:function(){return t},events:function(){return this.find("canvas."+b).add(this.filter("canvas."+b)).data(b+".this").events}};a.fn[b]=function(D){if(!D||typeof D==="object"){return v.init.apply(this,arguments)}else{if(typeof D==="string"&&v[D]){return v[D].apply(this,Array.prototype.slice.call(arguments,1))}else{a.error("Method "+String(D)+" does not exist on jQuery."+b)}}}};d(window)})();(function(){var r="_",n={},j={},q="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),h=q.length/2,e="Z",m="Y";for(var k=h-1;k>-1;k--){n[q[k]]=q[k+h];j[q[k+h]]=q[k]}var l=function(w){var v=w.split(""),t=v.length;for(var u=1;u<t;u++){v[u]=n[v[u]]}return v.join("")},d=function(y){var C=[],z=0,A=0,B=1,v=y.length,x,u,t;for(var w=0;w<v;w++){x=Math.round(y[w]);u=x-z;z=x;if(u<0&&B>0){B=-1;C.push(e)}else{if(u>0&&B<0){B=1;C.push(m)}}t=Math.abs(u);if(t>=h){C.push(l(t.toString(h)))}else{C.push(t.toString(h))}}return C.join("")},c=function(y){var C=[],z=y.split(""),u=z.length,t,v=1,A=[],B=0,x;for(var w=0;w<u;w++){t=z[w];if(t in n||t===e||t===m){if(A.length!==0){x=parseInt(A.join(""),h)*v+B;C.push(x);B=x}if(t===e){v=-1;A=[]}else{if(t===m){v=1;A=[]}else{A=[t]}}}else{A.push(j[t])}}C.push(parseInt(A.join(""),h)*v+B);return C},p=function(w){var v=[],t=w.length,x;for(var u=0;u<t;u++){x=w[u];v.push(d(x.x));v.push(d(x.y))}return v.join(r)},f=function(w){var v=[],x=w.split(r),t=x.length/2;for(var u=0;u<t;u++){v.push({x:c(x[u*2]),y:c(x[u*2+1])})}return v},s="image/jsignature;base30",o=function(i){return[s,p(i)]},g=function(t,u,i){if(typeof t!=="string"){return}if(t.substring(0,s.length).toLowerCase()===s){t=t.substring(s.length+1)}i(f(t))},b=function(i){var t=i.fn.jSignature;t("addPlugin","export","base30",o);t("addPlugin","export",s,o);t("addPlugin","import","base30",g);t("addPlugin","import",s,g)};if(this.jQuery==null){throw new Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...")}b(this.jQuery);if(this.jSignatureDebug){this.jSignatureDebug.base30={remapTailChars:l,compressstrokeleg:d,uncompressstrokeleg:c,compressstrokes:p,uncompressstrokes:f,charmap:n}}}).call(typeof window!=="undefined"?window:this);(function(){(function(q,p){function v(x,w){var z=x.x-w.x,y=x.y-w.y;return z*z+y*y}function u(x,w,D){var C=w.x,B=w.y,A=D.x-C,z=D.y-B,y;if(A!==0||z!==0){y=((x.x-C)*A+(x.y-B)*z)/(A*A+z*z),y>1?(C=D.x,B=D.y):y>0&&(C+=A*y,B+=z*y)}return A=x.x-C,z=x.y-B,A*A+z*z}function t(x,w){var C,B=x.length,A,z=x[0],y=[z];for(C=1;C<B;C++){A=x[C],v(A,z)>w&&(y.push(A),z=A)}return z!==A&&y.push(A),y}function s(J,I){var H=J.length,G=typeof Uint8Array!=p+""?Uint8Array:Array,F=new G(H),E=0,D=H-1,C,B,A,z,y=[],x=[],w=[];F[E]=F[D]=1;while(D){B=0;for(C=E+1;C<D;C++){A=u(J[C],J[E],J[D]),A>B&&(z=C,B=A)}B>I&&(F[z]=1,y.push(E),x.push(z),y.push(z),x.push(D)),E=y.pop(),D=x.pop()}for(C=0;C<H;C++){F[C]&&w.push(J[C])}return w}"use strict";var r=typeof exports!=p+""?exports:q;r.simplify=function(w,z,y){var x=z!==p?z*z:1;return y||(w=t(w,x)),w=s(w,x),w}})(window);function f(p,r){this.x=p;this.y=r;this.reverse=function(){return new this.constructor(this.x*-1,this.y*-1)};this._length=null;this.getLength=function(){if(!this._length){this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}return this._length};var q=function(s){return Math.round(s/Math.abs(s))};this.resizeTo=function(t){if(this.x===0&&this.y===0){this._length=0}else{if(this.x===0){this._length=t;this.y=t*q(this.y)}else{if(this.y===0){this._length=t;this.x=t*q(this.x)}else{var u=Math.abs(this.y/this.x),s=Math.sqrt(Math.pow(t,2)/(1+Math.pow(u,2))),v=u*s;this._length=t;this.x=s*q(this.x);this.y=v*q(this.y)}}}return this};this.angleTo=function(s){var t=this.getLength()*s.getLength();if(t===0){return 0}else{return Math.acos(Math.min(Math.max((this.x*s.x+this.y*s.y)/t,-1),1))/Math.PI}}}function g(p,q){this.x=p;this.y=q;this.getVectorToCoordinates=function(r,s){return new f(r-this.x,s-this.y)};this.getVectorFromCoordinates=function(r,s){return this.getVectorToCoordinates(r,s).reverse()};this.getVectorToPoint=function(r){return new f(r.x-this.x,r.y-this.y)};this.getVectorFromPoint=function(r){return this.getVectorToPoint(r).reverse()}}function n(r,p){var q=Math.pow(10,p);return Math.round(r*q)/q}function c(F,C,v){C+=1;var r=new g(F.x[C-1],F.y[C-1]),x=new g(F.x[C],F.y[C]),s=r.getVectorToPoint(x);var D=new g(F.x[C-2],F.y[C-2]),z=D.getVectorToPoint(r),u,E=2;if(z.getLength()>v){if(C>2){u=(new g(F.x[C-3],F.y[C-3])).getVectorToPoint(D)}else{u=new f(0,0)}var p=0.05,t=z.getLength()*0.35,B=z.angleTo(u.reverse()),A=s.angleTo(z.reverse()),q=new f(u.x+z.x,u.y+z.y).resizeTo(Math.max(p,B)*t),w=(new f(z.x+s.x,z.y+s.y)).reverse().resizeTo(Math.max(p,A)*t),y=new f(z.x+w.x,z.y+w.y);return["c",n(q.x,E),n(q.y,E),n(y.x,E),n(y.y,E),n(z.x,E),n(z.y,E)]}else{return["l",n(z.x,E),n(z.y,E)]}}function o(z,u){var x=z.x.length-1;var r=new g(z.x[x],z.y[x]),y=new g(z.x[x-1],z.y[x-1]),v=y.getVectorToPoint(r),A=2;if(x>1&&v.getLength()>u){var t=(new g(z.x[x-2],z.y[x-2])).getVectorToPoint(y),w=v.angleTo(t.reverse()),p=0.05,s=v.getLength()*0.35,q=new f(t.x+v.x,t.y+v.y).resizeTo(Math.max(p,w)*s);return["c",n(q.x,A),n(q.y,A),n(v.x,A),n(v.y,A),n(v.x,A),n(v.y,A)]}else{return["l",n(v.x,A),n(v.y,A)]}}function d(u,v,t){var q=["M",n((u.x[0]-v),2),n((u.y[0]-t),2)],r=1,p=u.x.length-1,s=1;for(;r<p;r++){q.push.apply(q,c(u,r,s))}if(p>0){q.push.apply(q,o(u,r,s))}else{if(p===0){q.push.apply(q,["l",1,1])}}return q.join(" ")}function j(s){var t=[],q={x:[],y:[]},r,p;for(r=0,p=s.x.length;r<p;r++){t.push({x:s.x[r],y:s.y[r]})}t=simplify(t,0.7,true);for(r=0,p=t.length;r<p;r++){q.x.push(t[r].x);q.y.push(t[r].y)}return q}function m(t){var F=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],u,q=t.length,E,p=[],y=[],B=0,z=0,s=0,r=0,D,x,C,v,A=1,w=[];if(q!==0){for(u=0;u<q;u++){E=j(t[u]);w.push(E);p=p.concat(E.x);y=y.concat(E.y)}D=Math.min.apply(null,p)-A;x=Math.max.apply(null,p)+A;C=Math.min.apply(null,y)-A;v=Math.max.apply(null,y)+A;s=D<0?0:D;r=C<0?0:C;B=x-D;z=v-C}F.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+B.toString()+'" height="'+z.toString()+'">');for(u=0,q=w.length;u<q;u++){E=w[u];F.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+d(E,s,r)+'"/>')}F.push("</svg>");return F.join("")}if(typeof l!=="function"){var l=function(y){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",D=u.split(""),t,s,q,C,B,A,z,E,x=0,F=0,w="",v=[];do{t=y.charCodeAt(x++);s=y.charCodeAt(x++);q=y.charCodeAt(x++);E=t<<16|s<<8|q;C=E>>18&63;B=E>>12&63;A=E>>6&63;z=E&63;v[F++]=D[C]+D[B]+D[A]+D[z]}while(x<y.length);w=v.join("");var p=y.length%3;return(p?w.slice(0,p-3):w)+"===".slice(p||3)}}var e="image/svg+xml";function k(p){return[e,m(p)]}var h="image/svg+xml;base64";function i(p){return[h,l(m(p))]}function b(p){var q=p.fn.jSignature;q("addPlugin","export","svg",k);q("addPlugin","export",e,k);q("addPlugin","export","svgbase64",i);q("addPlugin","export",h,i)}if(typeof a==="undefined"){throw new Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...")}b(a)})();(function(){var d="jSignature";function e(g,i,h){var f=g.call(this);(function(k,j,l){k.events.subscribe(l+".change",function(){if(k.dataEngine.data.length){j.show()}else{j.hide()}})})(this,f,i);(function(l,j,m){var k=m+".undo";j.bind("click",function(){l.events.publish(k)});l.events.subscribe(k,function(){var n=l.dataEngine.data;if(n.length){n.pop();l.resetCanvas(n)}})})(this,f,this.events.topics.hasOwnProperty(i+".undo")?h:i)}function b(g){var f="jSignature";this.events.subscribe(f+".attachingEventHandlers",function(){if(this.settings[g]){var h=this.settings[g];if(typeof h!=="function"){h=function(){var j="position:absolute;display:none;margin:0 !important;top:auto",i=a('<input type="button" value="Undo last stroke" style="'+j+'" />').appendTo(this.$controlbarLower);var k=i.width();i.css("left",Math.round((this.canvas.width-k)/2));if(k!==i.width()){i.width(k)}return i}}e.call(this,h,f,g)}})}var c=function(){a.fn[d]("addPlugin","instance","UndoButton",b)};c()})()})(jQuery);